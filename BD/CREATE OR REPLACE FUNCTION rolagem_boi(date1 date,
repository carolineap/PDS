CREATE OR REPLACE FUNCTION rolagem_boi(date1 date, date2 date)
  RETURNS TABLE (
	data_ajuste date,
  	codigo varchar,
  	vencimento varchar,
  	volume real,
  	contratos integer,
  	preco_abertura real,
  	preco_minimo real,
  	preco_maximo real,
  	ajuste_fechamento real,
  	ajuste_anterior real) AS
$func$
BEGIN
   RETURN QUERY
   SELECT * FROM boi WHERE boi.data_ajuste >= $1 AND boi.data_ajuste <= $2 AND CASE 
	WHEN EXTRACT(MONTH FROM boi.data_ajuste) = 1 THEN boi.vencimento = CONCAT('F', SUBSTRING(CAST((EXTRACT(YEAR FROM boi.data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM boi.data_ajuste) = 2 THEN boi.vencimento = CONCAT('G', SUBSTRING(CAST((EXTRACT(YEAR FROM boi.data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM boi.data_ajuste) = 3 THEN boi.vencimento = CONCAT('H', SUBSTRING(CAST((EXTRACT(YEAR FROM boi.data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM boi.data_ajuste) = 4 THEN boi.vencimento = CONCAT('J', SUBSTRING(CAST((EXTRACT(YEAR FROM boi.data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM boi.data_ajuste) = 5 THEN boi.vencimento = CONCAT('K', SUBSTRING(CAST((EXTRACT(YEAR FROM boi.data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM boi.data_ajuste) = 6 THEN boi.vencimento = CONCAT('M', SUBSTRING(CAST((EXTRACT(YEAR FROM boi.data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM boi.data_ajuste) = 7 THEN boi.vencimento = CONCAT('N', SUBSTRING(CAST((EXTRACT(YEAR FROM boi.data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM boi.data_ajuste) = 8 THEN boi.vencimento = CONCAT('Q', SUBSTRING(CAST((EXTRACT(YEAR FROM boi.data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM boi.data_ajuste) = 9 THEN boi.vencimento = CONCAT('U', SUBSTRING(CAST((EXTRACT(YEAR FROM boi.data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM boi.data_ajuste) = 10 THEN boi.vencimento = CONCAT('V', SUBSTRING(CAST((EXTRACT(YEAR FROM boi.data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM boi.data_ajuste) = 11 THEN boi.vencimento = CONCAT('X', SUBSTRING(CAST((EXTRACT(YEAR FROM boi.data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM boi.data_ajuste) = 12 THEN boi.vencimento = CONCAT('Z', SUBSTRING(CAST((EXTRACT(YEAR FROM boi.data_ajuste)) AS TEXT), 3, 2))
	END;
	END
$func$  LANGUAGE plpgsql;

SELECT * FROM rolagem_boi('01/01/2018', '31/01/2018');








SELECT * FROM milho WHERE data_ajuste >= '01/01/2018' AND CASE 
	WHEN EXTRACT(MONTH FROM data_ajuste) = 1 THEN vencimento = CONCAT('H', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 2 THEN vencimento = CONCAT('H', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 3 THEN vencimento = CONCAT('K', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 4 THEN vencimento = CONCAT('K', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 5 THEN vencimento = CONCAT('N', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 6 THEN vencimento = CONCAT('N', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 7 THEN vencimento = CONCAT('Q', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 8 THEN vencimento = CONCAT('U', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 9 THEN vencimento = CONCAT('X', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 10 THEN vencimento = CONCAT('X', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 11 THEN vencimento = CONCAT('F', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 12 THEN vencimento = CONCAT('F', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	END

SELECT * FROM cafe WHERE data_ajuste >= '01/01/2018' AND CASE 
	WHEN EXTRACT(MONTH FROM data_ajuste) = 1 THEN vencimento = CONCAT('H', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 2 THEN vencimento = CONCAT('H', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 3 THEN vencimento = CONCAT('K', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 4 THEN vencimento = CONCAT('K', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 5 THEN vencimento = CONCAT('N', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 6 THEN vencimento = CONCAT('N', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 7 THEN vencimento = CONCAT('U', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 8 THEN vencimento = CONCAT('U', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 9 THEN vencimento = CONCAT('Z', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 10 THEN vencimento = CONCAT('Z', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 11 THEN vencimento = CONCAT('Z', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 12 THEN vencimento = CONCAT('H', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	END

SELECT * FROM soja WHERE data_ajuste >= '01/01/2018' AND CASE 
	WHEN EXTRACT(MONTH FROM data_ajuste) = 1 THEN vencimento = CONCAT('H', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 2 THEN vencimento = CONCAT('H', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 3 THEN vencimento = CONCAT('J', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 4 THEN vencimento = CONCAT('K', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 5 THEN vencimento = CONCAT('M', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 6 THEN vencimento = CONCAT('N', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 7 THEN vencimento = CONCAT('Q', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 8 THEN vencimento = CONCAT('U', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 9 THEN vencimento = CONCAT('X', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 10 THEN vencimento = CONCAT('X', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 11 THEN vencimento = CONCAT('X', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	WHEN EXTRACT(MONTH FROM data_ajuste) = 12 THEN vencimento = CONCAT('X', SUBSTRING(CAST((EXTRACT(YEAR FROM data_ajuste)) AS TEXT), 3, 2))
	END









