<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <title>CPA - Gráficos </title>
          <meta charset="utf-8">
    </head>

    <body>
 
    <div class="header">
        <h2>
            Candle Stick
        </h2>
    </div>
 
    <div id="chart" class="chart"></div>
 
	</body>
 
    <!-- D3.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <!-- Plotly.js -->
    <script src="https://d14fo0winaifog.cloudfront.net/plotly-basic.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <script type="text/javascript">
          
        function candle(graph) {

            var layout = {
                'yaxis' : {
                    tickformat :".2f"
                },
                'xaxis' : {
                    tickformat :".2f"
                }
            };

            Plotly.plot('chart', graph, layout);

        }

    </script>

    <script type="text/javascript">

    $(document).ready(function() {
        d = localStorage.getItem('tabela');
        data = JSON.parse(d);
        
        if (data) {

            var x = [];
            var max = [];
            var min = [];
            var open = [];
            var close = [];
            var graph = [];
            var vencimento;

            vencimento = data[0].vencimento;

            for (var i = 0; i < data.length; i++) {
                if (vencimento != data[i].vencimento) {
                    alert("Não foi possível gerar o Candlestick! Os dados devem conter apenas um tipo de vencimento");
                    window.close();
                    return;
                }
                x.push(data[i].data);
                max.push(data[i].preco_max);
                min.push(data[i].preco_min);
                open.push(data[i].preco_abertura);
                close.push(data[i].ajuste_atual);
            }

            var trace = {
                x: x,
                close: close,
                high: max,
                low: min,
                open: open,
                type: 'candlestick'
            }

            graph.push(trace);

            candle(graph);
            
        } else {
            alert("Ocorreu um erro com a geração do gráfico! Tente novamente");
        }
    });

    </script>


    <div id="chart" style="width:600px;height:250px;"></div>

</html>
